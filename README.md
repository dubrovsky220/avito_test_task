# Тестовое задание Авито

## Основная идея

В данном проекте решалась задача восстановления пробелов в текстах поисковых запросов (например, `куплюайфон14про` → `куплю айфон 14 про`). Для решения задачи была выбрана архитектура BiLSTM с CRF на выходе. Основная идея заключается в том, что BiLSTM умеет учитывать контекст с обеих сторон символа, а CRF на выходе помогает моделировать зависимость между соседними метками, что особенно важно для корректного восстановления пробелов.

Были рассмотрены и другие подходы, включая обычные LSTM без CRF и трансформеры. LSTM без CRF часто допускали нелогичные разрывы, а трансформеры, хотя и давали бы высокое качество, были бы значительно тяжелее и медленнее для такой задачи, особенно на больших текстовых потоках. Поэтому была выбрана комбинация BiLSTM + CRF как оптимальный компромисс между точностью и вычислительной эффективностью.

Для снижения переобучения в модели применяются LayerNorm и Dropout, что стабилизирует обучение и улучшает обобщающую способность. В качестве оптимизатора используется AdamW, который хорошо справляется с задачами NLP и поддерживает регуляризацию весов. На текущих данных модель показывает достаточно высокую точность (метрика F1 превысила 0,9), при этом обучение и инференс остаются относительно быстрыми и легкими в вычислительном плане.

При этом имеется также потенциал для улучшения. Можно попробовать расширить датасет, включив в него реальные поисковые запросы, добавить простые эвристики (например, ставить пробел перед цифрами или заглавными буквами), а также применить learning rate scheduling при обучении. Дальнейшее улучшение результатов связано с применением более тяжелых моделей.

В целом, выбранная архитектура демонстрирует, что даже относительно легкая модель может давать неплохие результаты, оставаясь при этом значительно более быстрой по сравнению с тяжелыми трансформерами.


## Описание файлов проекта

* **`notebook.ipynb`** — подготовка данных, обучение модели и пояснения. Выполнение ноутбука в среде Google Colab на GPU T4 занимает около 1 часа.
* **`main.py`** — основной скрипт для инференса. Принимает текст без пробелов и возвращает CSV с позициями пробелов.
* **`dataset_raw/`** — исходные тексты (в проекте использовался датасет [Complex Russian Dataset](https://www.kaggle.com/datasets/artalmaz31/complex-russian-dataset)).
* **`dataset_processed/`** — предобработанный датасет для обучения модели.
* **`test_data/`** — тестовые данные от Авито (файлы формата `id,text_no_spaces`).
* **`model/`** — сохранённые веса модели (`.pt`) и словарь `char2id.json`.
* **`submits/`** — файлы сабмитов для проверки метрики на Stepik.


## Требования по железу

* **Обучение** — проводилось в среде Google Colab на GPU T4.
* **Инференс** — может выполняться на CPU, наличие GPU не обязательно.


## Инструкция по запуску

### 1. Клонировать репозиторий

```bash
git clone https://github.com/dubrovsky220/avito_test_task
cd avito_test_task
```

---

### 2. Создать виртуальное окружение

(в проекте использовался Python 3.11)

```bash
python3.11 -m venv .venv
```

Активировать окружение:

* Linux / macOS:

  ```bash
  source .venv/bin/activate
  ```
* Windows (PowerShell):

  ```powershell
  .venv\Scripts\activate
  ```

---

### 3. Установить зависимости

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

---

### 4. Запустить инференс

Скрипт принимает 3 аргумента:

* `--input_path` — путь к входному `.txt` файлу с колонками `id,text_no_spaces`.
* `--output_path` — путь для сохранения результата в `.csv` (формат: `id,predicted_positions`).
* `--restored_path` (опционально) — путь для сохранения текстов с восстановленными пробелами (в формате `.csv`).

Пример запуска:

```bash
python main.py --input_path ./test_data/dataset_1937770_3.txt --output_path ./preds.csv --restored_path ./restored.csv
```

---

### 5. Формат входных данных

Пример `test_data/dataset_1937770_3.txt`:

```
id,text_no_spaces
0,куплюайфон14про
1,ищудомвПодмосковье
2,сдаюквартирусмебельюитехникой
```

---

### 6. Формат выходных данных

Пример `preds.csv`:

```
id,predicted_positions
0,"[5, 10, 12]"
1,"[1, 6, 7]"
2,"[1, 4, 12, 20, 21]"
```

Опциональный файл `restored.csv`:

```
id,restored_text
0,куплю айфон 14 про
1,и щудом в Подмосковье
2,с даю квартиру смебелью и техникой
```



